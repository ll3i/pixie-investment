{% extends "layout.html" %}

{% block title %}단어 학습 - Pixie{% endblock %}

{% block extra_css %}
<style>
    /* 단어 학습 목록 페이지 스타일 */
    body {
        background: #F8F9FA;
    }

    .terms-container {
        max-width: 1200px;
        margin: 40px auto;
        padding: 0 20px;
    }

    /* 페이지 헤더 */
    .page-header {
        text-align: center;
        margin-bottom: 48px;
    }

    .page-title {
        font-size: 48px;
        font-weight: 700;
        color: #000;
        margin-bottom: 16px;
    }

    .page-subtitle {
        font-size: 20px;
        color: #666;
        margin-bottom: 32px;
    }

    /* 필터 섹션 */
    .filter-section {
        background: white;
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 32px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .filter-group {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
        align-items: center;
    }

    .filter-label {
        font-weight: 600;
        color: #333;
        margin-right: 8px;
    }

    .filter-btn {
        padding: 8px 20px;
        border: 1px solid #E5E5E5;
        background: white;
        border-radius: 20px;
        font-size: 14px;
        color: #666;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .filter-btn:hover {
        border-color: #1454FE;
        color: #1454FE;
    }

    .filter-btn.active {
        background: #1454FE;
        color: white;
        border-color: #1454FE;
    }

    /* 진행률 표시 */
    .progress-summary {
        background: linear-gradient(135deg, #1454FE 0%, #0B3DCF 100%);
        color: white;
        border-radius: 20px;
        padding: 32px;
        margin-bottom: 32px;
        text-align: center;
    }

    .progress-summary h3 {
        font-size: 24px;
        margin-bottom: 16px;
    }

    .progress-bar-container {
        background: rgba(255, 255, 255, 0.2);
        height: 12px;
        border-radius: 6px;
        overflow: hidden;
        margin-bottom: 16px;
    }

    .progress-bar-fill {
        background: white;
        height: 100%;
        transition: width 0.5s ease;
    }

    .progress-stats {
        display: flex;
        justify-content: center;
        gap: 48px;
        margin-top: 24px;
    }

    .progress-stat {
        text-align: center;
    }

    .progress-stat-value {
        font-size: 32px;
        font-weight: 700;
        display: block;
    }

    .progress-stat-label {
        font-size: 14px;
        opacity: 0.9;
    }

    /* 용어 카드 그리드 */
    .terms-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 24px;
        margin-bottom: 48px;
    }

    .term-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }

    .term-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    }

    .term-card.completed {
        border: 2px solid #4CAF50;
    }

    .term-card.completed::after {
        content: '✓';
        position: absolute;
        top: 16px;
        right: 16px;
        width: 32px;
        height: 32px;
        background: #4CAF50;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
    }

    .term-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 16px;
    }

    .term-title {
        font-size: 24px;
        font-weight: 700;
        color: #000;
        margin-bottom: 4px;
    }

    .term-korean {
        font-size: 18px;
        color: #1454FE;
        font-weight: 600;
    }

    .term-badges {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
    }

    .term-badge {
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
    }

    .badge-category {
        background: #E8EBFF;
        color: #1454FE;
    }

    .badge-difficulty {
        background: #FFE6CC;
        color: #FF6B00;
    }

    .badge-difficulty.초급 {
        background: #E8F5E9;
        color: #4CAF50;
    }

    .badge-difficulty.중급 {
        background: #FFF3E0;
        color: #FF9800;
    }

    .badge-difficulty.고급 {
        background: #FFEBEE;
        color: #F44336;
    }

    .term-description {
        font-size: 14px;
        color: #666;
        line-height: 1.6;
        margin-bottom: 16px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .term-action {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .learn-btn {
        background: #1454FE;
        color: white;
        padding: 8px 20px;
        border-radius: 8px;
        text-decoration: none;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .learn-btn:hover {
        background: #0B3DCF;
        color: white;
    }

    .term-card.completed .learn-btn {
        background: #E8EBFF;
        color: #1454FE;
    }

    /* 로딩 상태 */
    .loading {
        text-align: center;
        padding: 60px;
        color: #666;
    }

    .loading-spinner {
        width: 48px;
        height: 48px;
        border: 3px solid #E5E5E5;
        border-top-color: #1454FE;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 16px;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* 반응형 */
    @media (max-width: 768px) {
        .terms-grid {
            grid-template-columns: 1fr;
        }

        .progress-stats {
            flex-direction: column;
            gap: 24px;
        }

        .filter-group {
            flex-direction: column;
            align-items: stretch;
        }

        .filter-btn {
            width: 100%;
            text-align: center;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="terms-container">
    <!-- 페이지 헤더 -->
    <div class="page-header">
        <h1 class="page-title">단어 학습</h1>
        <p class="page-subtitle">투자 용어를 쉽고 체계적으로 학습해보세요</p>
    </div>

    <!-- 진행률 표시 -->
    <div class="progress-summary">
        <h3>나의 학습 진행률</h3>
        <div class="progress-bar-container">
            <div class="progress-bar-fill" id="progress-fill" style="width: 0%"></div>
        </div>
        <div class="progress-stats">
            <div class="progress-stat">
                <span class="progress-stat-value" id="completed-count">0</span>
                <span class="progress-stat-label">완료한 용어</span>
            </div>
            <div class="progress-stat">
                <span class="progress-stat-value" id="total-count">0</span>
                <span class="progress-stat-label">전체 용어</span>
            </div>
            <div class="progress-stat">
                <span class="progress-stat-value" id="progress-percent">0%</span>
                <span class="progress-stat-label">달성률</span>
            </div>
        </div>
    </div>

    <!-- 필터 섹션 -->
    <div class="filter-section">
        <div class="filter-group">
            <span class="filter-label">카테고리:</span>
            <button class="filter-btn active" onclick="filterTerms('category', 'all')">전체</button>
            <button class="filter-btn" onclick="filterTerms('category', '기본 지표')">기본 지표</button>
            <button class="filter-btn" onclick="filterTerms('category', '수익성 지표')">수익성 지표</button>
            <button class="filter-btn" onclick="filterTerms('category', '기본 개념')">기본 개념</button>
        </div>
        <div class="filter-group mt-3">
            <span class="filter-label">난이도:</span>
            <button class="filter-btn active" onclick="filterTerms('difficulty', 'all')">전체</button>
            <button class="filter-btn" onclick="filterTerms('difficulty', '초급')">초급</button>
            <button class="filter-btn" onclick="filterTerms('difficulty', '중급')">중급</button>
            <button class="filter-btn" onclick="filterTerms('difficulty', '고급')">고급</button>
        </div>
    </div>

    <!-- 용어 카드 그리드 -->
    <div class="terms-grid" id="terms-grid">
        <div class="loading">
            <div class="loading-spinner"></div>
            <p>용어를 불러오는 중...</p>
        </div>
    </div>
</div>

<script>
let allTerms = [];
let completedTerms = [];
let currentFilter = {
    category: 'all',
    difficulty: 'all'
};

// 페이지 로드 시 초기화
document.addEventListener('DOMContentLoaded', function() {
    loadTerms();
    loadProgress();
});

// 용어 목록 불러오기
function loadTerms() {
    fetch('/api/learning/terms')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                allTerms = data.terms;
                displayTerms();
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
}

// 진행률 불러오기
function loadProgress() {
    fetch('/api/learning/progress')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const progress = data.progress;
                completedTerms = progress.completed_terms || [];
                updateProgressDisplay(progress);
            }
        });
}

// 진행률 표시 업데이트
function updateProgressDisplay(progress) {
    document.getElementById('completed-count').textContent = progress.completed_terms;
    document.getElementById('total-count').textContent = progress.total_terms;
    document.getElementById('progress-percent').textContent = `${progress.progress_percentage}%`;
    document.getElementById('progress-fill').style.width = `${progress.progress_percentage}%`;
}

// 용어 카드 표시
function displayTerms() {
    const grid = document.getElementById('terms-grid');
    const filteredTerms = filterTermsList();
    
    if (filteredTerms.length === 0) {
        grid.innerHTML = '<div class="loading"><p>해당하는 용어가 없습니다.</p></div>';
        return;
    }
    
    grid.innerHTML = filteredTerms.map(term => `
        <div class="term-card ${completedTerms.includes(term.id) ? 'completed' : ''}" onclick="location.href='/learning/term/${term.id}'">
            <div class="term-header">
                <div>
                    <h3 class="term-title">${term.term}</h3>
                    <div class="term-korean">${term.korean}</div>
                </div>
            </div>
            <div class="term-badges">
                <span class="term-badge badge-category">${term.category}</span>
                <span class="term-badge badge-difficulty ${term.difficulty}">${term.difficulty}</span>
            </div>
            <p class="term-description">${term.definition}</p>
            <div class="term-action">
                <a href="/learning/term/${term.id}" class="learn-btn" onclick="event.stopPropagation()">
                    ${completedTerms.includes(term.id) ? '다시 학습하기' : '학습하기'}
                </a>
            </div>
        </div>
    `).join('');
}

// 필터링
function filterTermsList() {
    return allTerms.filter(term => {
        const categoryMatch = currentFilter.category === 'all' || term.category === currentFilter.category;
        const difficultyMatch = currentFilter.difficulty === 'all' || term.difficulty === currentFilter.difficulty;
        return categoryMatch && difficultyMatch;
    });
}

// 필터 적용
function filterTerms(type, value) {
    currentFilter[type] = value;
    
    // 버튼 활성화 상태 업데이트
    document.querySelectorAll('.filter-btn').forEach(btn => {
        if (btn.onclick && btn.onclick.toString().includes(type) && btn.onclick.toString().includes(value)) {
            btn.classList.add('active');
        } else if (btn.onclick && btn.onclick.toString().includes(type)) {
            btn.classList.remove('active');
        }
    });
    
    displayTerms();
}
</script>
{% endblock %}