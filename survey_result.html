{% extends "layout.html" %}

{% block title %}투자 성향 분석 결과 - Pixie{% endblock %}

{% block extra_css %}
<style>
    /* Figma 디자인 기반 설문 결과 스타일 */
    :root {
        --pixie-primary: #1454FE;
        --pixie-primary-hover: #0B3DCF;
        --pixie-error: #FE3F14;
        --pixie-secondary: #CADBFF;
        --pixie-black: #000000;
        --pixie-dark-gray: #474747;
        --pixie-light-gray: #F5F5F5;
        --pixie-white: #FFFFFF;
        --pixie-text-primary: #000000;
        --pixie-text-secondary: #474747;
    }

    /* 전체 페이지 스타일 */
    body {
        background: white;
        font-family: 'Pretendard', sans-serif;
    }

    /* 메인 컨테이너 */
    .result-page {
        width: 100%;
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 40px;
        background: white;
        min-height: 100vh;
    }

    /* 헤더 섹션 */
    .result-header {
        margin-top: 60px;
        margin-bottom: 40px;
    }

    .result-subtitle {
        color: var(--pixie-black);
        font-size: 28px;
        font-weight: 600;
        line-height: 39.2px;
        margin-bottom: 24px;
    }

    .result-subtitle .highlight {
        color: var(--pixie-primary);
    }

    .result-title {
        color: var(--pixie-black);
        font-size: 48px;
        font-weight: 700;
        margin-bottom: 8px;
    }

    .result-description {
        color: var(--pixie-dark-gray);
        font-size: 16px;
        font-weight: 400;
        line-height: 24px;
        max-width: 600px;
    }

    /* 점수 카드 그리드 래퍼 */
    .scores-section {
        width: 100%;
        margin-bottom: 60px;
        padding-bottom: 60px;
        border-bottom: 1px solid #E5E5E5;
    }

    /* 점수 카드 그리드 */
    .scores-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 24px;
        width: 100%;
        max-width: 1300px;
        margin: 0 auto;
        align-items: stretch;
    }

    /* 개별 점수 카드 */
    .score-card {
        background: #F8F9FA;
        border-radius: 20px;
        padding: 24px;
        min-height: 280px;
        height: 100%;
        display: flex;
        flex-direction: column;
        position: relative;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    }

    .score-header {
        margin-bottom: 16px;
        flex-shrink: 0;
    }

    .score-value {
        color: #FF4B4B;
        font-size: 16px;
        font-weight: 400;
        line-height: 24px;
        margin-bottom: 8px;
    }

    .score-value.positive {
        color: #5B6BFF;
    }

    .score-name {
        color: #1A1A1A;
        font-size: 20px;
        font-weight: 600;
        line-height: 28px;
    }

    .score-name-en {
        display: block;
        font-size: 16px;
        font-weight: 400;
        color: #666;
        margin-top: 4px;
    }

    .score-description {
        color: #333;
        font-size: 14px;
        font-weight: 400;
        line-height: 20px;
        flex: 1;
        margin-bottom: 16px;
    }

    /* 픽시 조언 박스 */
    .pixie-advice {
        background: #E8EBFF;
        border-radius: 12px;
        padding: 16px 20px;
        margin-top: auto;
        flex-shrink: 0;
    }

    .pixie-advice-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
    }

    .pixie-icon {
        width: 20px;
        height: 20px;
        background: #5B6BFF;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 12px;
    }

    .pixie-advice-title {
        color: #1A1A1A;
        font-size: 14px;
        font-weight: 600;
        line-height: 20px;
    }

    .pixie-advice-content {
        color: #333;
        font-size: 14px;
        font-weight: 400;
        line-height: 20px;
    }

    /* 하단 섹션 컨테이너 */
    .bottom-section {
        background: white;
        padding: 60px 0;
        margin-bottom: 80px;
        margin-top: 60px;
    }

    .bottom-content-wrapper {
        background: #F8F9FA;
        border-radius: 20px;
        padding: 60px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 60px;
        align-items: start;
    }

    /* 핵심 특징 섹션 */
    .key-features {
        background: white;
        border-radius: 16px;
        padding: 32px;
    }

    .section-title {
        color: var(--pixie-black);
        font-size: 20px;
        font-weight: 700;
        line-height: 28px;
        margin-bottom: 32px;
    }

    .feature-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .feature-item {
        display: flex;
        align-items: flex-start;
        gap: 12px;
    }

    .feature-icon {
        width: 32px;
        height: 32px;
        background: #E8EBFF;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        margin-top: 0;
    }

    .feature-icon svg {
        width: 16px;
        height: 16px;
        fill: var(--pixie-primary);
    }

    .feature-content {
        flex: 1;
    }

    .feature-title {
        color: var(--pixie-black);
        font-size: 15px;
        font-weight: 600;
        line-height: 22px;
        margin-bottom: 2px;
    }

    .feature-description {
        color: #666;
        font-size: 14px;
        font-weight: 400;
        line-height: 20px;
        margin-top: 4px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    /* 추천 전략 & 종합 평가 섹션 */
    .strategy-evaluation {
        display: flex;
        flex-direction: column;
        gap: 40px;
    }

    .strategy-box,
    .evaluation-box {
        background: white;
        border-radius: 16px;
        padding: 32px;
        margin-bottom: 0;
    }

    .strategy-content,
    .evaluation-content {
        color: #333;
        font-size: 15px;
        font-weight: 400;
        line-height: 24px;
    }

    .strategy-content .highlight {
        color: var(--pixie-primary);
        font-weight: 600;
    }

    .strategy-content ul,
    .evaluation-content ul {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .strategy-content li,
    .evaluation-content li {
        position: relative;
        padding-left: 20px;
        margin-bottom: 12px;
        line-height: 24px;
    }

    .strategy-content li:before,
    .evaluation-content li:before {
        content: "\2022";
        position: absolute;
        left: 0;
        color: var(--pixie-primary);
        font-weight: bold;
    }

    .key-features .section-title {
        font-size: 18px;
        margin-bottom: 32px;
        font-weight: 700;
    }

    .strategy-box .section-title,
    .evaluation-box .section-title {
        font-size: 18px;
        margin-bottom: 24px;
        font-weight: 700;
    }

    /* 포트폴리오 추천 섹션 */
    .portfolio-section {
        margin-bottom: 100px;
    }

    .portfolio-header {
        text-align: center;
        margin-bottom: 40px;
    }

    .portfolio-title {
        color: var(--pixie-black);
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 16px;
    }

    .portfolio-subtitle {
        color: var(--pixie-dark-gray);
        font-size: 18px;
        font-weight: 400;
        line-height: 27px;
    }

    .portfolio-card {
        background: var(--pixie-light-gray);
        border-radius: 20px;
        padding: 40px;
        margin-bottom: 24px;
    }

    .portfolio-name {
        color: var(--pixie-black);
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 12px;
    }

    .portfolio-description {
        color: var(--pixie-dark-gray);
        font-size: 16px;
        font-weight: 400;
        line-height: 24px;
        margin-bottom: 24px;
    }

    .portfolio-assets {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
    }

    .asset-item {
        background: var(--pixie-white);
        border-radius: 12px;
        padding: 16px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .asset-name {
        color: var(--pixie-black);
        font-size: 16px;
        font-weight: 500;
    }

    .asset-allocation {
        color: var(--pixie-primary);
        font-size: 16px;
        font-weight: 600;
    }

    /* 액션 버튼 */
    .action-buttons {
        text-align: center;
        margin-bottom: 100px;
    }

    .action-btn {
        background: var(--pixie-primary);
        color: var(--pixie-white);
        font-size: 18px;
        font-weight: 600;
        padding: 16px 40px;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        margin: 0 12px;
        transition: all 0.3s ease;
    }

    .action-btn:hover {
        background: var(--pixie-primary-hover);
        transform: translateY(-2px);
    }

    .action-btn.secondary {
        background: transparent;
        color: var(--pixie-primary);
        border: 2px solid var(--pixie-primary);
    }

    .action-btn.secondary:hover {
        background: var(--pixie-primary);
        color: var(--pixie-white);
    }

    /* 포트폴리오 차트 스타일 */
    .portfolio-chart-container {
        position: relative;
        height: 400px;
        margin: 32px 0;
    }

    .portfolio-tips {
        text-align: center;
        color: #666;
        font-size: 14px;
        margin-top: 16px;
    }

    .portfolio-tips i {
        color: var(--pixie-primary);
        margin-right: 8px;
    }

    /* 추천 종목 섹션 */
    .recommended-stocks {
        margin-top: 48px;
    }

    .section-subtitle {
        font-size: 24px;
        font-weight: 600;
        color: var(--pixie-black);
        margin-bottom: 24px;
    }

    .stocks-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 24px;
    }

    .stock-card {
        background: white;
        border: 1px solid #E5E5E5;
        border-radius: 16px;
        padding: 24px;
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .stock-card:hover {
        border-color: var(--pixie-primary);
        box-shadow: 0 4px 12px rgba(20, 84, 254, 0.1);
        transform: translateY(-2px);
    }

    .stock-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
    }

    .stock-name {
        font-size: 18px;
        font-weight: 600;
        color: var(--pixie-black);
    }

    .stock-code {
        font-size: 14px;
        color: #666;
    }

    .stock-price {
        font-size: 24px;
        font-weight: 700;
        color: var(--pixie-black);
        margin-bottom: 8px;
    }

    .stock-change {
        font-size: 16px;
        font-weight: 500;
        margin-bottom: 16px;
    }

    .stock-change.up {
        color: #FE3F14;
    }

    .stock-change.down {
        color: #1454FE;
    }

    .stock-metrics {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        padding-top: 16px;
        border-top: 1px solid #E5E5E5;
    }

    .metric-item {
        display: flex;
        flex-direction: column;
    }

    .metric-label {
        font-size: 12px;
        color: #666;
        margin-bottom: 4px;
    }

    .metric-value {
        font-size: 14px;
        font-weight: 600;
        color: var(--pixie-black);
    }

    /* 반응형 디자인 */
    @media (max-width: 1600px) {
        .result-page {
            padding: 0 80px;
        }
        
        .scores-grid-wrapper {
            max-width: 1100px;
        }
    }

    @media (max-width: 1400px) {
        .result-page {
            padding: 0 40px;
        }

        .scores-grid {
            max-width: 1200px;
        }

        .score-card {
            padding: 20px;
        }
    }

    @media (max-width: 1200px) {
        .scores-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .feature-list {
            gap: 20px;
        }

        .bottom-content-wrapper {
            grid-template-columns: 1fr;
            gap: 40px;
            padding: 40px;
        }

        .strategy-evaluation {
            gap: 40px;
        }
    }

    @media (max-width: 768px) {
        .result-page {
            padding: 0 20px;
        }

        .scores-grid {
            grid-template-columns: 1fr;
            gap: 16px;
        }

        .score-card {
            min-height: 250px;
        }

        .result-title {
            font-size: 36px;
        }

        .result-subtitle {
            font-size: 24px;
        }

        .bottom-section {
            padding: 40px 0;
        }

        .feature-list {
            gap: 14px;
        }

        .key-features,
        .strategy-box,
        .evaluation-box {
            padding: 24px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="result-page">
    <!-- 헤더 섹션 -->
    <div class="result-header">
        <h2 class="result-subtitle">
            {{ session.get('user_name', '사용자') }} 님의<br>
            <span class="highlight">투자 성향</span> 분석 결과예요
        </h2>
        <h1 class="result-title">{{ investment_type.type }}</h1>
        <p class="result-description">{{ investment_type.description }}</p>
    </div>

    <!-- 점수 카드 섹션 -->
    <div class="scores-section">
        <div class="scores-grid">
        <!-- 위험 감수성 -->
        <div class="score-card">
            <div class="score-header">
                <div class="score-value {% if scores.risk_tolerance > 0 %}positive{% endif %}">
                    {{ scores.risk_tolerance }}점 
                    {% if scores.risk_tolerance >= 1.5 %}매우 높음
                    {% elif scores.risk_tolerance >= 0.5 %}높음
                    {% elif scores.risk_tolerance >= -0.5 %}중립
                    {% elif scores.risk_tolerance >= -1.5 %}낮음
                    {% else %}매우 낮음{% endif %}
                </div>
                <h3 class="score-name">
                    위험 감수성
                    <span class="score-name-en">(Risk Tolerance)</span>
                </h3>
            </div>
            <p class="score-description">
                {% if detailed_analysis and detailed_analysis.risk_tolerance_analysis %}
                    {{ detailed_analysis.risk_tolerance_analysis }}
                {% else %}
                    위험에 대한 태도를 나타냅니다.
                {% endif %}
            </p>
            {% if investment_type.recommendations and investment_type.recommendations[0] %}
            <div class="pixie-advice">
                <div class="pixie-advice-header">
                    <div class="pixie-icon">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                        <path d="M6 0C6.33 0 6.6 0.27 6.6 0.6V5.4H11.4C11.73 5.4 12 5.67 12 6C12 6.33 11.73 6.6 11.4 6.6H6.6V11.4C6.6 11.73 6.33 12 6 12C5.67 12 5.4 11.73 5.4 11.4V6.6H0.6C0.27 6.6 0 6.33 0 6C0 5.67 0.27 5.4 0.6 5.4H5.4V0.6C5.4 0.27 5.67 0 6 0Z" fill="white"/>
                    </svg>
                </div>
                    <div class="pixie-advice-title">픽시의 조언</div>
                </div>
                <p class="pixie-advice-content">{{ investment_type.recommendations[0] }}</p>
            </div>
            {% endif %}
        </div>

        <!-- 투자 기간 -->
        <div class="score-card">
            <div class="score-header">
                <div class="score-value {% if scores.investment_time_horizon > 0 %}positive{% endif %}">
                    {{ scores.investment_time_horizon }}점 
                    {% if scores.investment_time_horizon >= 1.5 %}매우 높음
                    {% elif scores.investment_time_horizon >= 0.5 %}높음
                    {% elif scores.investment_time_horizon >= -0.5 %}중립
                    {% elif scores.investment_time_horizon >= -1.5 %}낮음
                    {% else %}매우 낮음{% endif %}
                </div>
                <h3 class="score-name">
                    투자 시간 범위
                    <span class="score-name-en">(Investment Time Horizon)</span>
                </h3>
            </div>
            <p class="score-description">
                {% if detailed_analysis and detailed_analysis.investment_time_horizon_analysis %}
                    {{ detailed_analysis.investment_time_horizon_analysis }}
                {% else %}
                    투자 기간에 대한 선호도를 나타냅니다.
                {% endif %}
            </p>
            {% if investment_type.recommendations and investment_type.recommendations[1] %}
            <div class="pixie-advice">
                <div class="pixie-advice-header">
                    <div class="pixie-icon">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                        <path d="M6 0C6.33 0 6.6 0.27 6.6 0.6V5.4H11.4C11.73 5.4 12 5.67 12 6C12 6.33 11.73 6.6 11.4 6.6H6.6V11.4C6.6 11.73 6.33 12 6 12C5.67 12 5.4 11.73 5.4 11.4V6.6H0.6C0.27 6.6 0 6.33 0 6C0 5.67 0.27 5.4 0.6 5.4H5.4V0.6C5.4 0.27 5.67 0 6 0Z" fill="white"/>
                    </svg>
                </div>
                    <div class="pixie-advice-title">픽시의 조언</div>
                </div>
                <p class="pixie-advice-content">{{ investment_type.recommendations[1] }}</p>
            </div>
            {% endif %}
        </div>

        <!-- 재무 목표 지향성 -->
        <div class="score-card">
            <div class="score-header">
                <div class="score-value {% if scores.financial_goal_orientation > 0 %}positive{% endif %}">
                    {{ scores.financial_goal_orientation }}점 
                    {% if scores.financial_goal_orientation >= 1.5 %}매우 높음
                    {% elif scores.financial_goal_orientation >= 0.5 %}높음
                    {% elif scores.financial_goal_orientation >= -0.5 %}중립
                    {% elif scores.financial_goal_orientation >= -1.5 %}낮음
                    {% else %}매우 낮음{% endif %}
                </div>
                <h3 class="score-name">
                    재무 목표 지향성
                    <span class="score-name-en">(Financial Goal Orientation)</span>
                </h3>
            </div>
            <p class="score-description">
                {% if detailed_analysis and detailed_analysis.financial_goal_orientation_analysis %}
                    {{ detailed_analysis.financial_goal_orientation_analysis }}
                {% else %}
                    재무 목표에 대한 명확성을 나타냅니다.
                {% endif %}
            </p>
            {% if investment_type.recommendations and investment_type.recommendations[2] %}
            <div class="pixie-advice">
                <div class="pixie-advice-header">
                    <div class="pixie-icon">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                        <path d="M6 0C6.33 0 6.6 0.27 6.6 0.6V5.4H11.4C11.73 5.4 12 5.67 12 6C12 6.33 11.73 6.6 11.4 6.6H6.6V11.4C6.6 11.73 6.33 12 6 12C5.67 12 5.4 11.73 5.4 11.4V6.6H0.6C0.27 6.6 0 6.33 0 6C0 5.67 0.27 5.4 0.6 5.4H5.4V0.6C5.4 0.27 5.67 0 6 0Z" fill="white"/>
                    </svg>
                </div>
                    <div class="pixie-advice-title">픽시의 조언</div>
                </div>
                <p class="pixie-advice-content">{{ investment_type.recommendations[2] }}</p>
            </div>
            {% endif %}
        </div>

        <!-- 정보 처리 스타일 -->
        <div class="score-card">
            <div class="score-header">
                <div class="score-value {% if scores.information_processing_style > 0 %}positive{% endif %}">
                    {{ scores.information_processing_style }}점 
                    {% if scores.information_processing_style >= 1.5 %}매우 높음
                    {% elif scores.information_processing_style >= 0.5 %}높음
                    {% elif scores.information_processing_style >= -0.5 %}중립
                    {% elif scores.information_processing_style >= -1.5 %}낮음
                    {% else %}매우 낮음{% endif %}
                </div>
                <h3 class="score-name">
                    정보 처리 스타일
                    <span class="score-name-en">(Information Processing Style)</span>
                </h3>
            </div>
            <p class="score-description">
                {% if detailed_analysis and detailed_analysis.information_processing_style_analysis %}
                    {{ detailed_analysis.information_processing_style_analysis }}
                {% else %}
                    정보를 처리하는 방식을 나타냅니다.
                {% endif %}
            </p>
            {% if investment_type.recommendations and investment_type.recommendations[3] %}
            <div class="pixie-advice">
                <div class="pixie-advice-header">
                    <div class="pixie-icon">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                        <path d="M6 0C6.33 0 6.6 0.27 6.6 0.6V5.4H11.4C11.73 5.4 12 5.67 12 6C12 6.33 11.73 6.6 11.4 6.6H6.6V11.4C6.6 11.73 6.33 12 6 12C5.67 12 5.4 11.73 5.4 11.4V6.6H0.6C0.27 6.6 0 6.33 0 6C0 5.67 0.27 5.4 0.6 5.4H5.4V0.6C5.4 0.27 5.67 0 6 0Z" fill="white"/>
                    </svg>
                </div>
                    <div class="pixie-advice-title">픽시의 조언</div>
                </div>
                <p class="pixie-advice-content">{{ investment_type.recommendations[3] }}</p>
            </div>
            {% endif %}
        </div>

        <!-- 투자 두려움 -->
        <div class="score-card">
            <div class="score-header">
                <div class="score-value {% if scores.investment_fear < 0 %}positive{% endif %}">
                    {{ scores.investment_fear }}점 
                    {% if scores.investment_fear >= 1.5 %}매우 높음
                    {% elif scores.investment_fear >= 0.5 %}높음
                    {% elif scores.investment_fear >= -0.5 %}중립
                    {% elif scores.investment_fear >= -1.5 %}낮음
                    {% else %}매우 낮음{% endif %}
                </div>
                <h3 class="score-name">
                    투자 두려움
                    <span class="score-name-en">(Investment Fear)</span>
                </h3>
            </div>
            <p class="score-description">
                {% if detailed_analysis and detailed_analysis.investment_fear_analysis %}
                    {{ detailed_analysis.investment_fear_analysis }}
                {% else %}
                    투자에 대한 두려움 정도를 나타냅니다.
                {% endif %}
            </p>
            {% if investment_type.recommendations and investment_type.recommendations[4] %}
            <div class="pixie-advice">
                <div class="pixie-advice-header">
                    <div class="pixie-icon">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                        <path d="M6 0C6.33 0 6.6 0.27 6.6 0.6V5.4H11.4C11.73 5.4 12 5.67 12 6C12 6.33 11.73 6.6 11.4 6.6H6.6V11.4C6.6 11.73 6.33 12 6 12C5.67 12 5.4 11.73 5.4 11.4V6.6H0.6C0.27 6.6 0 6.33 0 6C0 5.67 0.27 5.4 0.6 5.4H5.4V0.6C5.4 0.27 5.67 0 6 0Z" fill="white"/>
                    </svg>
                </div>
                    <div class="pixie-advice-title">픽시의 조언</div>
                </div>
                <p class="pixie-advice-content">{{ investment_type.recommendations[4] }}</p>
            </div>
            {% endif %}
        </div>

        <!-- 투자 자신감 -->
        <div class="score-card">
            <div class="score-header">
                <div class="score-value {% if scores.investment_confidence > 0 %}positive{% endif %}">
                    {{ scores.investment_confidence }}점 
                    {% if scores.investment_confidence >= 1.5 %}매우 높음
                    {% elif scores.investment_confidence >= 0.5 %}높음
                    {% elif scores.investment_confidence >= -0.5 %}중립
                    {% elif scores.investment_confidence >= -1.5 %}낮음
                    {% else %}매우 낮음{% endif %}
                </div>
                <h3 class="score-name">
                    투자 자신감
                    <span class="score-name-en">(Investment Confidence)</span>
                </h3>
            </div>
            <p class="score-description">
                {% if detailed_analysis and detailed_analysis.investment_confidence_analysis %}
                    {{ detailed_analysis.investment_confidence_analysis }}
                {% else %}
                    투자 결정에 대한 자신감을 나타냅니다.
                {% endif %}
            </p>
            {% if investment_type.recommendations and investment_type.recommendations[5] %}
            <div class="pixie-advice">
                <div class="pixie-advice-header">
                    <div class="pixie-icon">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                        <path d="M6 0C6.33 0 6.6 0.27 6.6 0.6V5.4H11.4C11.73 5.4 12 5.67 12 6C12 6.33 11.73 6.6 11.4 6.6H6.6V11.4C6.6 11.73 6.33 12 6 12C5.67 12 5.4 11.73 5.4 11.4V6.6H0.6C0.27 6.6 0 6.33 0 6C0 5.67 0.27 5.4 0.6 5.4H5.4V0.6C5.4 0.27 5.67 0 6 0Z" fill="white"/>
                    </svg>
                </div>
                    <div class="pixie-advice-title">픽시의 조언</div>
                </div>
                <p class="pixie-advice-content">{{ investment_type.recommendations[5] }}</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- 하단 섹션: 핵심 특징, 추천 전략, 종합 평가 -->
    <div class="bottom-section">
        <div class="bottom-content-wrapper">
            <!-- 핵심 특징 (왼쪽) -->
            <div class="key-features">
                <h3 class="section-title">핵심 특징</h3>
                <div class="feature-list">
                    {% for characteristic in investment_type.characteristics %}
                    <div class="feature-item">
                        <div class="feature-icon">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M6 10.78L2.22 7L1.14 8.08L6 12.94L14.86 4.08L13.78 3L6 10.78Z" fill="#1454FE"/>
                            </svg>
                        </div>
                        <div class="feature-content">
                            <h4 class="feature-title">{{ characteristic }}</h4>
                            {% if loop.index0 < investment_type.characteristic_details|length %}
                            <p class="feature-description">{{ investment_type.characteristic_details[loop.index0] }}</p>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- 추천 전략 & 종합 평가 (오른쪽) -->
            <div class="strategy-evaluation">
                <div class="strategy-box">
                    <h3 class="section-title">추천 전략</h3>
                    <p class="strategy-content">
                        {% if investment_type.strategy %}
                            {{ investment_type.strategy|safe }}
                        {% else %}
                            안정적인 자산을 중심으로 투자하고<br>
                            <span class="highlight">재무 목표 설정 → 관련 지식 습득 → 경험 축적</span>의 순서로 기반을 다지세요.<br>
                            투자 앱이나 플랫폼에서 제공하는 초보자용 콘텐츠, 리포트 등을 꾸준히 참고해보는 것도 좋습니다.
                        {% endif %}
                    </p>
                </div>
                
                <div class="evaluation-box">
                    <h3 class="section-title">종합 평가</h3>
                    <p class="evaluation-content">
                        {% if detailed_analysis and detailed_analysis.overall_evaluation %}
                            {{ detailed_analysis.overall_evaluation }}
                        {% elif overall_analysis %}
                            {{ overall_analysis }}
                        {% else %}
                            투자에 대한 종합적인 평가가 준비 중입니다.
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- 맞춤 포트폴리오 추천 -->
    <div class="portfolio-section">
        <div class="portfolio-header">
            <h2 class="portfolio-title">맞춤 포트폴리오 추천</h2>
            <p class="portfolio-subtitle">
                {{ session.get('user_name', '사용자') }}님의 투자 성향에 맞는 포트폴리오를 추천해드립니다
            </p>
        </div>
        
        <div class="portfolio-card">
            <h3 class="portfolio-name">균형형 포트폴리오</h3>
            <p class="portfolio-description">위험과 수익의 균형을 추구하며, 다양한 자산에 분산 투자하는 포트폴리오입니다.</p>
            
            <div class="portfolio-chart-container">
                <canvas id="portfolioChart"></canvas>
            </div>
            
            <div class="portfolio-tips">
                <p><i class="fas fa-info-circle"></i> 그래프를 클릭하면 상세 종목을 확인할 수 있습니다</p>
            </div>
        </div>
        
        <div class="recommended-stocks">
            <h4 class="section-subtitle">추천 종목</h4>
            <div id="recommendedStocksGrid" class="stocks-grid">
                <!-- 동적으로 로드됨 -->
            </div>
        </div>
    </div>

    <!-- 액션 버튼 -->
    <div class="action-buttons">
        <a href="/chatbot" class="action-btn">AI 투자 상담 받기</a>
        <a href="/survey" class="action-btn secondary">설문 다시하기</a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="/static/js/portfolio-chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 사용자 투자 성향 데이터
    const userProfile = {
        riskTolerance: {{ scores.risk_tolerance|default(0) }},
        investmentHorizon: {{ scores.investment_time_horizon|default(0) }},
        financialGoal: {{ scores.financial_goal_orientation|default(0) }},
        investmentType: "{{ investment_type.type }}"
    };

    // 투자 성향에 따른 포트폴리오 구성 비율 설정
    let portfolioData = {
        labels: [],
        data: [],
        stocks: {}
    };

    // 위험 성향에 따른 포트폴리오 구성
    if (userProfile.riskTolerance >= 1.5) {
        // 공격적 투자자
        portfolioData.labels = ['국내 주식', '해외 주식', '대체 투자', '채권', '현금성 자산'];
        portfolioData.data = [45, 30, 10, 10, 5];
    } else if (userProfile.riskTolerance >= 0.5) {
        // 적극적 투자자
        portfolioData.labels = ['국내 주식', '해외 주식', '채권', '대체 투자', '현금성 자산'];
        portfolioData.data = [35, 25, 20, 10, 10];
    } else if (userProfile.riskTolerance >= -0.5) {
        // 중립적 투자자
        portfolioData.labels = ['국내 주식', '해외 주식', '채권', '현금성 자산', '대체 투자'];
        portfolioData.data = [30, 20, 30, 15, 5];
    } else {
        // 보수적 투자자
        portfolioData.labels = ['채권', '국내 주식', '현금성 자산', '해외 주식', '대체 투자'];
        portfolioData.data = [40, 20, 20, 15, 5];
    }

    // window에 포트폴리오 데이터 저장 (차트 클릭 이벤트용)
    window.portfolioData = portfolioData;

    // 추천 종목 로드
    loadRecommendedStocks();

    async function loadRecommendedStocks() {
        try {
            const response = await fetch('/api/recommendations/stocks', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    investmentType: userProfile.investmentType,
                    riskTolerance: userProfile.riskTolerance
                })
            });

            if (response.ok) {
                const data = await response.json();
                displayRecommendedStocks(data.stocks);
                
                // 포트폴리오 데이터에 종목 정보 추가
                if (data.stocksByCategory) {
                    window.portfolioData.stocks = data.stocksByCategory;
                }
            }
        } catch (error) {
            console.error('추천 종목 로드 실패:', error);
            // 기본 추천 종목 표시
            displayDefaultStocks();
        }
    }

    function displayRecommendedStocks(stocks) {
        const grid = document.getElementById('recommendedStocksGrid');
        if (!grid) return;

        grid.innerHTML = stocks.map(stock => `
            <div class="stock-card" onclick="viewStockDetail('${stock.ticker}')">
                <div class="stock-header">
                    <div>
                        <div class="stock-name">${stock.name}</div>
                        <div class="stock-code">${stock.ticker}</div>
                    </div>
                </div>
                <div class="stock-price">${formatNumber(stock.currentPrice)}원</div>
                <div class="stock-change ${stock.changePercent > 0 ? 'up' : 'down'}">
                    ${stock.changePercent > 0 ? '+' : ''}${stock.changePercent.toFixed(2)}%
                </div>
                <div class="stock-metrics">
                    <div class="metric-item">
                        <span class="metric-label">평가점수</span>
                        <span class="metric-value">${stock.score}점</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">PER</span>
                        <span class="metric-value">${stock.per ? stock.per.toFixed(1) : '-'}</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">부채비율</span>
                        <span class="metric-value">${stock.debtRatio ? stock.debtRatio.toFixed(0) + '%' : '-'}</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">종합평가</span>
                        <span class="metric-value">${stock.evaluation}</span>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function displayDefaultStocks() {
        // 위험 성향에 따른 기본 추천 종목
        const defaultStocks = userProfile.riskTolerance >= 0 ? [
            {ticker: '005930', name: '삼성전자', currentPrice: 78200, changePercent: 1.2, score: 85, evaluation: '매수'},
            {ticker: '000660', name: 'SK하이닉스', currentPrice: 138500, changePercent: -0.5, score: 82, evaluation: '매수'},
            {ticker: '035420', name: 'NAVER', currentPrice: 215000, changePercent: 2.1, score: 80, evaluation: '보유'}
        ] : [
            {ticker: '005380', name: '현대차', currentPrice: 195000, changePercent: 0.8, score: 78, evaluation: '보유'},
            {ticker: '055550', name: '신한지주', currentPrice: 42500, changePercent: -0.3, score: 76, evaluation: '보유'},
            {ticker: '105560', name: 'KB금융', currentPrice: 58200, changePercent: 0.5, score: 75, evaluation: '보유'}
        ];

        displayRecommendedStocks(defaultStocks);
    }

    function formatNumber(num) {
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    
    // 차트 생성 (portfolio-chart.js의 로직을 보완)
    const chartCanvas = document.getElementById('portfolioChart');
    if (chartCanvas && window.portfolioData) {
        const config = {
            type: 'pie',
            data: {
                labels: window.portfolioData.labels,
                datasets: [{
                    data: window.portfolioData.data,
                    backgroundColor: [
                        '#1454FE',
                        '#5B6BFF',
                        '#8B95FF',
                        '#CADBFF',
                        '#E8EBFF'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            padding: 20,
                            font: {
                                size: 14,
                                family: 'Pretendard'
                            },
                            generateLabels: function(chart) {
                                const data = chart.data;
                                if (data.labels.length && data.datasets.length) {
                                    return data.labels.map((label, i) => {
                                        const dataset = data.datasets[0];
                                        const value = dataset.data[i];
                                        return {
                                            text: `${label} ${value}%`,
                                            fillStyle: dataset.backgroundColor[i],
                                            hidden: false,
                                            index: i
                                        };
                                    });
                                }
                                return [];
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.parsed || 0;
                                return `${label}: ${value}%`;
                            }
                        }
                    }
                },
                onClick: handleChartClick
            }
        };
        
        new Chart(chartCanvas, config);
    }
    
    // 차트 클릭 핸들러
    function handleChartClick(event, activeElements) {
        if (activeElements.length > 0) {
            const index = activeElements[0].index;
            const category = window.portfolioData.labels[index];
            const stocks = window.portfolioData.stocks[category];
            
            if (stocks && stocks.length > 0) {
                if (typeof window.showStockModal === 'function') {
                    window.showStockModal(category, stocks);
                }
            }
        }
    }
});

function viewStockDetail(ticker) {
    // portfolio-chart.js의 showStockReportModal 함수를 호출
    if (typeof window.showStockReportModal === 'function') {
        window.showStockReportModal(ticker);
    } else {
        // 폴백: 상세 페이지로 이동
        window.location.href = `/stock?ticker=${ticker}`;
    }
}
</script>
{% endblock %}