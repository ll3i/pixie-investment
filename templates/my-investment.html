{% extends 'layout.html' %}
{% block title %}MY 투자{% endblock %}
{% block extra_css %}
<style>
    /* Main Container */
    .my-investment-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 40px 20px;
    }

    /* Hero Section */
    .hero-section {
        background: #F8F9FA;
        padding: 60px 0;
        margin-bottom: 40px;
    }

    .hero-content {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .hero-text h1 {
        font-size: 48px;
        font-weight: 700;
        color: #000;
        margin-bottom: 16px;
        line-height: 1.2;
    }

    .hero-text p {
        font-size: 18px;
        color: #666;
        line-height: 1.6;
    }

    .hero-image {
        width: 400px;
        height: auto;
    }

    /* Section Title */
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
    }

    .section-title {
        font-size: 24px;
        font-weight: 700;
        color: #000;
    }

    .carousel-nav {
        display: flex;
        gap: 12px;
    }

    .carousel-btn {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background: #F5F5F5;
        border: none;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
    }

    .carousel-btn:hover {
        background: #E5E5E5;
    }

    .carousel-btn i {
        font-size: 16px;
        color: #666;
    }

    /* Watchlist Section */
    .watchlist-section {
        margin-bottom: 60px;
    }

    .watchlist-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }

    .stock-card {
        background: white;
        border: 1px solid #E5E5E5;
        border-radius: 12px;
        padding: 24px;
        transition: all 0.2s;
        cursor: pointer;
    }

    .stock-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transform: translateY(-2px);
    }

    .stock-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 12px;
    }

    .stock-category {
        font-size: 12px;
        color: #1454FE;
        background: #E6EFFF;
        padding: 4px 12px;
        border-radius: 4px;
        font-weight: 600;
    }

    .stock-name {
        font-size: 20px;
        font-weight: 700;
        color: #000;
        margin-bottom: 4px;
    }

    .stock-ticker {
        font-size: 14px;
        color: #666;
        margin-bottom: 16px;
    }

    .stock-price {
        font-size: 28px;
        font-weight: 700;
        color: #000;
        margin-bottom: 8px;
    }

    .stock-change {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 16px;
        font-weight: 500;
    }

    .stock-change.up {
        color: #E60000;
    }

    .stock-change.down {
        color: #0051C7;
    }

    .stock-change i {
        font-size: 12px;
    }

    .stock-footer {
        margin-top: 20px;
        padding-top: 16px;
        border-top: 1px solid #F0F0F0;
        font-size: 14px;
        color: #666;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    /* Add Stock Card */
    .add-stock-card {
        background: #F8F9FA;
        border: 2px dashed #D5D5D5;
        border-radius: 12px;
        padding: 24px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 280px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .add-stock-card:hover {
        border-color: #1454FE;
        background: #F0F5FF;
    }

    .add-stock-icon {
        width: 60px;
        height: 60px;
        background: #1454FE;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 16px;
    }

    .add-stock-icon i {
        font-size: 28px;
        color: white;
    }

    .add-stock-text {
        font-size: 16px;
        font-weight: 600;
        color: #666;
    }

    /* Risk Alert Section */
    .risk-section {
        margin-bottom: 60px;
    }

    .alert-card {
        background: white;
        border: 1px solid #E5E5E5;
        border-radius: 12px;
        padding: 20px 24px;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 20px;
    }

    .alert-icon {
        width: 48px;
        height: 48px;
        background: #FFF0F0;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .alert-icon.warning {
        background: #FFF0F0;
    }

    .alert-icon.warning i {
        color: #E60000;
        font-size: 24px;
    }

    .alert-content {
        flex: 1;
    }

    .alert-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 4px;
    }

    .alert-title {
        font-size: 18px;
        font-weight: 700;
        color: #000;
    }

    .alert-badge {
        font-size: 12px;
        color: #E60000;
        background: #FFF0F0;
        padding: 4px 12px;
        border-radius: 4px;
        font-weight: 600;
    }

    .alert-description {
        font-size: 14px;
        color: #666;
        line-height: 1.5;
    }

    .alert-action {
        margin-left: auto;
        display: flex;
        gap: 12px;
    }

    .alert-btn {
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
    }

    .alert-btn.primary {
        background: #1454FE;
        color: white;
    }

    .alert-btn.primary:hover {
        background: #0B3DCF;
    }

    .alert-btn.dismiss {
        background: transparent;
        color: #666;
    }

    .alert-btn.dismiss:hover {
        background: #F5F5F5;
    }

    /* Survey Report Section */
    .survey-section {
        margin-bottom: 60px;
    }

    .survey-content {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 24px;
    }

    .survey-summary {
        background: white;
        border: 1px solid #E5E5E5;
        border-radius: 12px;
        padding: 32px;
    }

    .survey-summary h3 {
        font-size: 20px;
        font-weight: 700;
        color: #000;
        margin-bottom: 24px;
    }

    .metric-item {
        margin-bottom: 24px;
    }

    .metric-label {
        font-size: 16px;
        font-weight: 600;
        color: #000;
        margin-bottom: 8px;
    }

    .metric-value {
        font-size: 24px;
        font-weight: 700;
        color: #1454FE;
        margin-bottom: 8px;
    }

    .metric-bar {
        width: 100%;
        height: 8px;
        background: #F0F0F0;
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 8px;
    }

    .metric-fill {
        height: 100%;
        background: #1454FE;
        transition: width 0.5s ease;
    }

    .metric-description {
        font-size: 14px;
        color: #666;
        line-height: 1.5;
    }

    .portfolio-visualization {
        background: white;
        border: 1px solid #E5E5E5;
        border-radius: 12px;
        padding: 32px;
    }

    .portfolio-visualization h3 {
        font-size: 20px;
        font-weight: 700;
        color: #000;
        margin-bottom: 16px;
    }

    .portfolio-description {
        font-size: 16px;
        color: #666;
        margin-bottom: 32px;
        line-height: 1.5;
    }

    .portfolio-chart {
        display: flex;
        align-items: flex-end;
        justify-content: space-around;
        height: 250px;
        margin-bottom: 32px;
    }

    .portfolio-bar {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 12px;
    }

    .bar-value {
        font-size: 24px;
        font-weight: 700;
    }

    .bar-column {
        width: 80px;
        background: #FF933B;
        border-radius: 8px 8px 0 0;
        transition: height 0.5s ease;
    }

    .bar-label {
        font-size: 14px;
        font-weight: 600;
        color: #666;
        text-align: center;
        max-width: 100px;
    }

    .report-btn {
        width: 100%;
        padding: 16px;
        background: #1454FE;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    .report-btn:hover {
        background: #0B3DCF;
    }

    /* News Section */
    .news-section {
        margin-bottom: 60px;
    }

    .news-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 24px;
    }

    .news-card {
        background: white;
        border: 1px solid #E5E5E5;
        border-radius: 12px;
        padding: 24px;
        transition: all 0.2s;
        cursor: pointer;
    }

    .news-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transform: translateY(-2px);
    }

    .news-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }

    .news-stock {
        font-size: 14px;
        font-weight: 600;
        color: #1454FE;
    }

    .news-date {
        font-size: 14px;
        color: #999;
    }

    .news-title {
        font-size: 18px;
        font-weight: 700;
        color: #000;
        margin-bottom: 8px;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .news-description {
        font-size: 14px;
        color: #666;
        line-height: 1.6;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .more-news-btn {
        display: block;
        text-align: center;
        margin-top: 32px;
    }

    .more-news-btn a {
        color: #1454FE;
        font-size: 16px;
        font-weight: 600;
        text-decoration: none;
    }

    .more-news-btn a:hover {
        text-decoration: underline;
    }

    /* Modal Styles */
    .modal-header {
        border-bottom: 1px solid #E5E5E5;
        padding: 24px;
    }

    .modal-title {
        font-size: 20px;
        font-weight: 700;
        color: #000;
    }

    .modal-body {
        padding: 24px;
    }

    .search-box {
        position: relative;
        margin-bottom: 20px;
    }

    .search-box input {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid #E5E5E5;
        border-radius: 8px;
        font-size: 16px;
    }

    .search-box input:focus {
        outline: none;
        border-color: #1454FE;
    }

    .search-results {
        max-height: 400px;
        overflow-y: auto;
    }

    .search-item {
        padding: 16px;
        border-bottom: 1px solid #F0F0F0;
        cursor: pointer;
        transition: all 0.2s;
    }

    .search-item:hover {
        background: #F8F9FA;
    }

    .search-item-name {
        font-size: 16px;
        font-weight: 600;
        color: #000;
        margin-bottom: 4px;
    }

    .search-item-info {
        font-size: 14px;
        color: #666;
    }

    /* Financial Insights Styles */
    .insights-section {
        margin-bottom: 48px;
    }
    
    #financial-insights-container {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 24px;
    }
    
    .insight-card {
        background: white;
        border: 1px solid #E5E5E5;
        border-radius: 12px;
        padding: 24px;
        transition: all 0.2s;
        cursor: pointer;
        overflow: visible;
    }
    
    .insight-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transform: translateY(-2px);
    }
    
    .insight-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 16px;
        border-bottom: 1px solid #F0F0F0;
    }
    
    .insight-header h4 {
        font-size: 18px;
        font-weight: 700;
        color: #000;
        margin: 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 70%;
    }
    
    .insight-header .badge {
        padding: 4px 12px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 600;
        white-space: nowrap;
    }
    
    .insight-metrics {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 20px;
    }
    
    .insight-metrics .metric-row {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
    }
    
    .insight-metrics .metric-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
        min-width: 0;
    }
    
    .insight-metrics .metric-item.full-width {
        grid-column: span 2;
    }
    
    .insight-metrics .metric-label {
        font-size: 12px;
        color: #666;
        font-weight: 400;
        white-space: nowrap;
        margin-bottom: 2px;
    }
    
    .insight-metrics .metric-value {
        font-size: 14px;
        font-weight: 700;
        color: #000;
        white-space: nowrap;
    }
    
    .insight-metrics .metric-value.text-success {
        color: #0051C7;
    }
    
    .insight-metrics .metric-value.text-danger {
        color: #E60000;
    }
    
    .insight-reason {
        background: #F8F9FA;
        border-radius: 12px;
        padding: 16px;
        font-size: 13px;
        color: #666;
        line-height: 1.6;
    }
    
    .insight-reason p {
        margin: 0;
        word-break: keep-all;
    }

    /* Risk Report Modal Styles */
    .risk-report-modal .modal-dialog {
        max-width: 800px;
    }
    
    .risk-summary {
        background: #FFF0F0;
        border: 1px solid #FFD4D4;
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
    }
    
    .risk-summary.medium {
        background: #FFF8E6;
        border-color: #FFE4A1;
    }
    
    .risk-summary.low {
        background: #E8F5E9;
        border-color: #A5D6A7;
    }
    
    .risk-level-badge {
        display: inline-block;
        padding: 6px 16px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 14px;
        margin-bottom: 12px;
    }
    
    .risk-level-badge.critical {
        background: #E60000;
        color: white;
    }
    
    .risk-level-badge.high {
        background: #FF5722;
        color: white;
    }
    
    .risk-level-badge.medium {
        background: #FFA000;
        color: white;
    }
    
    .risk-level-badge.low {
        background: #4CAF50;
        color: white;
    }
    
    .risk-factors {
        margin-bottom: 32px;
    }
    
    .risk-factor-item {
        background: white;
        border: 1px solid #E5E5E5;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 12px;
    }
    
    .risk-factor-title {
        font-size: 16px;
        font-weight: 600;
        color: #000;
        margin-bottom: 8px;
    }
    
    .risk-factor-analysis {
        font-size: 14px;
        color: #666;
        line-height: 1.6;
    }
    
    .metric-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
        margin-bottom: 24px;
    }
    
    .metric-card {
        background: #F8F9FA;
        border-radius: 8px;
        padding: 16px;
    }
    
    .metric-label {
        font-size: 12px;
        color: #666;
        margin-bottom: 4px;
    }
    
    .metric-value {
        font-size: 20px;
        font-weight: 700;
        color: #000;
    }
    
    .recommendations-section {
        background: #F0F5FF;
        border-radius: 12px;
        padding: 24px;
    }
    
    .recommendation-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .recommendation-list li {
        padding-left: 24px;
        position: relative;
        margin-bottom: 12px;
        font-size: 14px;
        line-height: 1.6;
    }
    
    .recommendation-list li:before {
        content: "•";
        position: absolute;
        left: 8px;
        color: #1454FE;
        font-weight: bold;
    }
    
    /* Financial Insights Section */
    .insights-section {
        margin-bottom: 60px;
    }
    
    .insights-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
    }
    
    .insight-card {
        background: white;
        border: 1px solid #E5E5E5;
        border-radius: 12px;
        padding: 24px;
        transition: all 0.2s;
    }
    
    .insight-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    
    .insight-type {
        font-size: 12px;
        color: #1454FE;
        background: #E6EFFF;
        padding: 4px 12px;
        border-radius: 4px;
        font-weight: 600;
        display: inline-block;
        margin-bottom: 12px;
    }
    
    .insight-title {
        font-size: 18px;
        font-weight: 700;
        color: #000;
        margin-bottom: 8px;
    }
    
    .insight-summary {
        font-size: 14px;
        color: #666;
        line-height: 1.6;
        margin-bottom: 16px;
    }
    
    .insight-metrics {
        border-top: 1px solid #F0F0F0;
        padding-top: 16px;
        display: flex;
        gap: 20px;
    }
    
    .insight-metric {
        flex: 1;
    }
    
    .insight-metric-label {
        font-size: 12px;
        color: #999;
        margin-bottom: 4px;
    }
    
    .insight-metric-value {
        font-size: 16px;
        font-weight: 600;
        color: #000;
    }

    /* Responsive */
    @media (max-width: 1400px) {
        #financial-insights-container {
            grid-template-columns: 1fr;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .insight-metrics .metric-row {
            grid-template-columns: repeat(3, 1fr);
        }
    }
    
    @media (max-width: 1200px) {
        .watchlist-grid {
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        }
        
        #financial-insights-container {
            grid-template-columns: 1fr;
            max-width: 600px;
        }
        
        .survey-content {
            grid-template-columns: 1fr;
        }
    }
    
    @media (max-width: 768px) {
        #financial-insights-container {
            padding: 0 10px;
        }
        
        .insight-card {
            padding: 20px;
        }
        
        .insight-metrics .metric-row {
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .insight-metrics .metric-item.full-width {
            grid-column: span 2;
        }
        
        .insight-header h4 {
            font-size: 18px;
            max-width: 65%;
        }
        
        .insight-header .badge {
            padding: 6px 12px;
            font-size: 12px;
        }
    }

    @media (max-width: 768px) {
        .hero-content {
            flex-direction: column;
            text-align: center;
        }
        
        .hero-text h1 {
            font-size: 36px;
        }
        
        .hero-image {
            width: 100%;
            max-width: 300px;
            margin-top: 32px;
        }
        
        .watchlist-grid,
        .news-grid {
            grid-template-columns: 1fr;
        }
        
        .portfolio-chart {
            height: 200px;
        }
        
        .alert-card {
            flex-direction: column;
            text-align: center;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="hero-content">
        <div class="hero-text">
            <h1>나만의 전략을 세우는<br>맞춤 투자 공간, MY투자</h1>
            <p>AI가 분석한 투자 성향과 관심 뉴스까지 한 곳에.<br>
               픽시와 함께 더 똑똑하고 안정적인 투자 여정을 시작해보세요.</p>
        </div>
        <div class="hero-image">
            <img src="{{ url_for('static', filename='images/invest1.png') }}" alt="MY투자">
        </div>
    </div>
</section>

<div class="my-investment-container">
    <!-- 관심 종목 Section -->
    <section class="watchlist-section">
        <div class="section-header">
            <h2 class="section-title">관심 종목</h2>
            <div class="carousel-nav">
                <button class="carousel-btn" onclick="scrollWatchlist('left')">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <button class="carousel-btn" onclick="scrollWatchlist('right')">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
        
        <div class="watchlist-grid" id="watchlist-container">
            <!-- 기본 관심 종목 - 동적으로 로드 -->
        </div>
    </section>

    <!-- 핵심 투자 인사이트 Section -->
    <section class="insights-section">
        <div class="section-header">
            <h2 class="section-title">핵심 투자 인사이트</h2>
        </div>
        
        <div id="financial-insights-container">
            <!-- 평가 데이터 기반 인사이트 동적 로드 -->
        </div>
    </section>

    <!-- 위험 신호 Section -->
    <section class="risk-section">
        <div class="section-header">
            <h2 class="section-title">위험 신호</h2>
        </div>
        
        <div id="risk-alerts-container">
            <!-- 위험 신호 동적 로드 -->
        </div>
    </section>

    <!-- 투자 설문 분석 결과 리포트 Section -->
    <section class="survey-section">
        <div class="section-header">
            <h2 class="section-title">투자 설문 분석 결과 리포트</h2>
        </div>
        
        <div class="survey-content">
            <div class="survey-summary">
                <h3>투자 성향 분석</h3>
                
                <div class="metric-item">
                    <div class="metric-label">위험 감수성</div>
                    <div class="metric-value">68%</div>
                    <div class="metric-bar">
                        <div class="metric-fill" style="width: 68%;"></div>
                    </div>
                    <div class="metric-description">
                        중간 수준으로, 적절한 리스크 관리가 필요합니다.
                    </div>
                </div>
                
                <div class="metric-item">
                    <div class="metric-label">투자 기간</div>
                    <div class="metric-value">장기</div>
                    <div class="metric-bar">
                        <div class="metric-fill" style="width: 80%;"></div>
                    </div>
                    <div class="metric-description">
                        장기 투자 선호, 안정적인 성장 추구
                    </div>
                </div>
                
                <button class="report-btn" onclick="location.href='/survey'">
                    전체 리포트 보기
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            
            <div class="portfolio-visualization">
                <h3>맞춤형 포트폴리오</h3>
                <p class="portfolio-description">
                    균형 잡힌 성장추구형 포트폴리오로, 안정성과 성장성 모두를 고려하는 투자자에게 적합합니다.
                </p>
                
                <div class="portfolio-chart">
                    <div class="portfolio-bar">
                        <span class="bar-value" style="color: #FF933B;">40%</span>
                        <div class="bar-column" style="height: 160px; background: #FF933B;"></div>
                        <span class="bar-label">주식형 펀드</span>
                    </div>
                    <div class="portfolio-bar">
                        <span class="bar-value" style="color: #1454FE;">30%</span>
                        <div class="bar-column" style="height: 120px; background: #1454FE;"></div>
                        <span class="bar-label">채권형 펀드</span>
                    </div>
                    <div class="portfolio-bar">
                        <span class="bar-value" style="color: #666;">30%</span>
                        <div class="bar-column" style="height: 120px; background: #666;"></div>
                        <span class="bar-label">현금</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 관심 종목 뉴스 Section -->
    <section class="news-section">
        <div class="section-header">
            <h2 class="section-title">관심 종목 뉴스</h2>
        </div>
        
        <div class="news-grid" id="watchlist-news-container">
            <!-- 관심 종목 뉴스 동적 로드 -->
        </div>
        
        <div class="more-news-btn">
            <a href="/news">더 많은 뉴스 보기</a>
        </div>
    </section>
</div>

<!-- 관심 종목 추가 모달 -->
<div class="modal fade" id="addWatchlistModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">관심 종목 추가</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="search-box">
                    <input type="text" id="stockSearch" placeholder="종목명 또는 종목코드를 입력하세요" autocomplete="off">
                </div>
                <div class="search-results" id="searchResults">
                    <!-- 검색 결과 동적 로드 -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 위험 분석 리포트 모달 -->
<div class="modal fade risk-report-modal" id="riskReportModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="riskReportTitle">위험 분석 리포트</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="riskReportContent">
                <!-- 리포트 내용 동적 로드 -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
                <button type="button" class="btn btn-primary" onclick="downloadRiskReport()">
                    <i class="fas fa-download"></i> 리포트 다운로드
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// 전역 변수
let watchlistStocks = [];
let allStocks = [];

// 페이지 로드시 초기화 함수는 아래 extra_js 블록에서 실행됩니다

// 관심 종목 로드
function loadWatchlist() {
    console.log('loadWatchlist 함수 실행');
    
    // 바로 디폴트 데이터 로드
    const container = $('#watchlist-container');
    container.empty();
    
    // 기본 관심 종목 설정
    watchlistStocks = [
        {
            ticker: '005930',
            name: '삼성전자',
            sector: '전기전자/반도체',
            price: 78200,
            change_percent: 1.35,
            change_price: 1040
        },
        {
            ticker: '373220',
            name: 'LG에너지솔루션',
            sector: '전기전자/2차전지',
            price: 394500,
            change_percent: -0.92,
            change_price: -3660
        },
        {
            ticker: '352820',
            name: '하이브',
            sector: '미디어/엔터테인먼트',
            price: 251000,
            change_percent: 0.48,
            change_price: 1200
        }
    ];
    
    // 관심 종목 렌더링
    watchlistStocks.forEach(stock => {
        const changeClass = stock.change_percent > 0 ? 'up' : 'down';
        const changeIcon = stock.change_percent > 0 ? 'fa-caret-up' : 'fa-caret-down';
        const changeSign = stock.change_percent > 0 ? '+' : '';
        
        const card = `
            <div class="stock-card" onclick="viewStockDetail('${stock.ticker}')">
                <div class="stock-header">
                    <span class="stock-category">${stock.sector || '주식'}</span>
                </div>
                <h3 class="stock-name">${stock.name}</h3>
                <p class="stock-ticker">종목 코드: ${stock.ticker}</p>
                <div class="stock-price">${formatNumber(stock.price)}원</div>
                <div class="stock-change ${changeClass}">
                    <i class="fas ${changeIcon}"></i>
                    <span>${changeSign}${stock.change_percent.toFixed(2)}%</span>
                    <span>(${changeSign}${formatNumber(Math.abs(stock.change_price))})</span>
                </div>
                <div class="stock-footer">
                    <i class="far fa-newspaper"></i>
                    <span>${getStockNewsTitle(stock.ticker)}</span>
                </div>
            </div>
        `;
        container.append(card);
    });
    
    // 추가 버튼
    const addCard = `
        <div class="add-stock-card" onclick="$('#addWatchlistModal').modal('show')">
            <div class="add-stock-icon">
                <i class="fas fa-plus"></i>
            </div>
            <p class="add-stock-text">관심 종목 추가</p>
        </div>
    `;
    container.append(addCard);
}

// 금융 인사이트 로드
function loadFinancialInsights() {
    console.log('loadFinancialInsights 함수 실행');
    
    $.ajax({
        url: '/api/comprehensive-analysis',
        method: 'GET',
        success: function(response) {
            if (response.success && response.comprehensive_analysis) {
                const insights = response.comprehensive_analysis.top_insights || [];
                const container = $('#insights-container');
                container.empty();
                
                if (insights.length === 0) {
                    container.html('<p class="text-center text-muted">아직 생성된 인사이트가 없습니다.</p>');
                    return;
                }
                
                insights.slice(0, 6).forEach(insight => {
                    const insightCard = `
                        <div class="insight-card" onclick="viewStockDetail('${insight.ticker}')">
                            <span class="insight-type">핵심 인사이트</span>
                            <h3 class="insight-title">${insight.title}</h3>
                            <p class="insight-summary">${insight.summary}</p>
                            <div class="insight-metrics">
                                <div class="insight-metric">
                                    <div class="insight-metric-label">종목</div>
                                    <div class="insight-metric-value">${insight.stock_name}</div>
                                </div>
                            </div>
                        </div>
                    `;
                    container.append(insightCard);
                });
            }
        },
        error: function(error) {
            console.error('인사이트 로드 실패:', error);
            // 샘플 데이터 표시
            displaySampleInsights();
        }
    });
}

// 샘플 인사이트 표시
function displaySampleInsights() {
    const sampleInsights = [
        {
            type: 'growth',
            title: '삼성전자 실적 개선 전망',
            summary: '반도체 시장 회복과 함께 영업이익 개선이 예상됩니다. 메모리 가격 상승이 주요 동력입니다.',
            stock_name: '삼성전자',
            ticker: '005930'
        },
        {
            type: 'valuation',
            title: 'LG에너지솔루션 저평가 구간',
            summary: 'PER 28배로 업종 평균 대비 저평가 상태입니다. 북미 시장 확대가 긍정적입니다.',
            stock_name: 'LG에너지솔루션',
            ticker: '373220'
        }
    ];
    
    const container = $('#insights-container');
    container.empty();
    
    sampleInsights.forEach(insight => {
        const typeLabel = insight.type === 'growth' ? '성장성' : 
                         insight.type === 'valuation' ? '밸류에이션' : '기술적분석';
        const insightCard = `
            <div class="insight-card" onclick="viewStockDetail('${insight.ticker}')">
                <span class="insight-type">${typeLabel}</span>
                <h3 class="insight-title">${insight.title}</h3>
                <p class="insight-summary">${insight.summary}</p>
                <div class="insight-metrics">
                    <div class="insight-metric">
                        <div class="insight-metric-label">종목</div>
                        <div class="insight-metric-value">${insight.stock_name}</div>
                    </div>
                </div>
            </div>
        `;
        container.append(insightCard);
    });
}

// 위험 신호 로드
function loadRiskAlerts() {
    console.log('loadRiskAlerts 함수 실행');
    
    $.ajax({
        url: '/api/risk-alerts',
        method: 'GET',
        success: function(response) {
            if (response.success) {
                const alerts = response.alerts || [];
                displayRiskAlerts(alerts);
            }
        },
        error: function(error) {
            console.error('위험 신호 로드 실패:', error);
            // 기본 샘플 데이터 표시
            displaySampleRiskAlerts();
        }
    });
}

// 위험 신호 표시
function displayRiskAlerts(alerts) {
    const container = $('#risk-alerts-container');
    container.empty();
    
    if (alerts.length === 0) {
        container.html('<p class="text-center text-muted">현재 감지된 위험 신호가 없습니다.</p>');
        return;
    }
    
    alerts.forEach(alert => {
        const alertHtml = `
            <div class="alert-card">
                <div class="alert-icon ${alert.level}">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="alert-content">
                    <div class="alert-header">
                        <h3 class="alert-title">${alert.stock_name}</h3>
                        <span class="alert-badge">${alert.title}</span>
                    </div>
                    <p class="alert-description">${alert.description}</p>
                </div>
                <div class="alert-action">
                    <button class="alert-btn primary" onclick="showRiskReport('${alert.ticker}')">자세히 보기</button>
                    <button class="alert-btn dismiss" onclick="dismissAlert(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        `;
        container.append(alertHtml);
    });
}

// 샘플 위험 신호 표시
function displaySampleRiskAlerts() {
    const alerts = [
        {
            stock_name: '삼성전자',
            title: 'RSI 과매도 신호 감지됨',
            description: '지금 투자하기엔 너무 신중한 판단이 필요합니다!',
            level: 'warning',
            ticker: '005930'
        },
        {
            stock_name: 'SK 하이닉스',
            title: '거래량 급증, 주의가 필요해요',
            description: '시장의 큰 손이 움직일을 수도 있어요!',
            level: 'warning',
            ticker: '000660'
        }
    ];
    
    displayRiskAlerts(alerts);
}

// 핵심 투자 인사이트 로드
function loadFinancialInsights() {
    console.log('loadFinancialInsights 함수 실행');
    
    const container = $('#financial-insights-container');
    container.html('<div class="text-center"><div class="spinner-border" role="status"></div></div>');
    
    // 임시로 샘플 데이터 표시
    const sampleInsights = [
        {
            종목코드: '005930',
            종목명: '삼성전자',
            현재가: '78,200원',
            시가총액: '4,671,940억원',
            매출성장률: '23.48%',
            순이익률: '15.23%',
            부채비율: '42.31%',
            PER: '11.82',
            PBR: '1.45',
            평가점수: 85,
            종합평가: '우수',
            평가이유: '매출 성장률이 23.48%로 우수함; 순이익률이 15.23%로 우수함; 부채비율이 42.31%로 안정적; PER이 11.82로 적정 수준; PBR이 1.45로 적정 수준'
        },
        {
            종목코드: '000660',
            종목명: 'SK하이닉스',
            현재가: '138,500원',
            시가총액: '1,009,254억원',
            매출성장률: '18.92%',
            순이익률: '8.75%',
            부채비율: '68.45%',
            PER: '15.23',
            PBR: '2.11',
            평가점수: 75,
            종합평가: '양호',
            평가이유: '매출 성장률이 18.92%로 우수함; 순이익률이 8.75%로 양호함; 부채비율이 68.45%로 관리 필요; PER이 15.23로 적정 수준'
        },
        {
            종목코드: '035720',
            종목명: '카카오',
            현재가: '42,350원',
            시가총액: '188,234억원',
            매출성장률: '12.15%',
            순이익률: '3.24%',
            부채비율: '85.67%',
            PER: '28.91',
            PBR: '1.87',
            평가점수: 60,
            종합평가: '보통',
            평가이유: '매출 성장률이 12.15%로 양호함; 순이익률이 3.24%로 개선 필요; 부채비율이 85.67%로 높음; PER이 28.91로 다소 고평가'
        },
        {
            종목코드: '373220',
            종목명: 'LG에너지솔루션',
            현재가: '394,500원',
            시가총액: '922,430억원',
            매출성장률: '32.15%',
            순이익률: '12.86%',
            부채비율: '55.23%',
            PER: '19.45',
            PBR: '2.87',
            평가점수: 78,
            종합평가: '양호',
            평가이유: '매출 성장률이 32.15%로 매우 우수함; 순이익률이 12.86%로 우수함; 부채비율이 55.23%로 양호함; PER이 19.45로 적정 수준; 북미 시장 확대로 성장성 높음'
        }
    ];
    
    container.empty();
    
    const insightCards = sampleInsights.map(insight => `
        <div class="insight-card">
            <div class="insight-header">
                <h4>${insight.종목명}</h4>
                <span class="badge" style="background: ${insight.평가점수 >= 80 ? '#E6EFFF' : insight.평가점수 >= 60 ? '#FFF8E6' : '#FFF0F0'}; color: ${insight.평가점수 >= 80 ? '#1454FE' : insight.평가점수 >= 60 ? '#FFA000' : '#E60000'};">
                    ${insight.종합평가}
                </span>
            </div>
            <div class="insight-metrics">
                <div class="metric-row">
                    <div class="metric-item">
                        <span class="metric-label">종목코드</span>
                        <span class="metric-value">${insight.종목코드}</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">현재가</span>
                        <span class="metric-value">${insight.현재가}</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">시가총액</span>
                        <span class="metric-value">${insight.시가총액}</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">평가점수</span>
                        <span class="metric-value">${insight.평가점수}점</span>
                    </div>
                </div>
                <div class="metric-row">
                    <div class="metric-item">
                        <span class="metric-label">매출성장률</span>
                        <span class="metric-value ${parseFloat(insight.매출성장률) < 0 ? 'text-danger' : ''}">${insight.매출성장률}</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">순이익률</span>
                        <span class="metric-value ${parseFloat(insight.순이익률) < 0 ? 'text-danger' : ''}">${insight.순이익률}</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">부채비율</span>
                        <span class="metric-value ${parseFloat(insight.부채비율) > 100 ? 'text-danger' : ''}">${insight.부채비율}</span>
                    </div>
                </div>
                <div class="metric-row">
                    <div class="metric-item">
                        <span class="metric-label">PER</span>
                        <span class="metric-value">${insight.PER}</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">PBR</span>
                        <span class="metric-value">${insight.PBR}</span>
                    </div>
                </div>
            </div>
            <div class="insight-reason">
                <p class="mb-0">${insight.평가이유}</p>
            </div>
        </div>
    `).join('');
    
    container.html(insightCards);
    
    // 실제 API 호출 시도 (백그라운드)
    $.ajax({
        url: '/api/comprehensive-analysis',
        method: 'GET',
        success: function(response) {
            console.log('API 응답:', response);
            // 실제 데이터가 있으면 업데이트
        },
        error: function(xhr, status, error) {
            console.log('API 호출 실패 (예상됨):', error);
        }
    });
}

// 관심 종목 뉴스 로드
function loadWatchlistNews() {
    console.log('loadWatchlistNews 함수 실행');
    
    // 바로 샘플 뉴스 데이터 표시
    const container = $('#watchlist-news-container');
    container.empty();
    
    const sampleNews = [
                {
                    stock: '삼성전자',
                    title: '삼성전자, 2분기 실적 예상치 상회',
                    description: '삼성전자가 2분기 잠정 실적에서 시장 예상을 뛰어넘는 성과를 기록했다고 밝혔습니다.',
                    date: '2시간 전'
                },
                {
                    stock: 'LG에너지솔루션',
                    title: 'LG엔솔, IRA 수혜로 북미 시장 확대',
                    description: 'LG에너지솔루션이 미국 인플레이션 감축법(IRA) 혜택을 받으며 북미 시장 점유율을 확대하고 있습니다.',
                    date: '3시간 전'
                },
                {
                    stock: '하이브',
                    title: '하이브, BTS 멤버 솔로 활동으로 실적 호조',
                    description: '하이브가 소속 아티스트들의 활발한 솔로 활동으로 안정적인 실적을 이어가고 있습니다.',
                    date: '5시간 전'
                }
            ];
            
            sampleNews.forEach(news => {
                const newsCard = `
                    <div class="news-card" onclick="window.open('#', '_blank')">
                        <div class="news-meta">
                            <span class="news-stock">${news.stock}</span>
                            <span class="news-date">${news.date}</span>
                        </div>
                        <h3 class="news-title">${news.title}</h3>
                        <p class="news-description">${news.description}</p>
                    </div>
                `;
                container.append(newsCard);
            });
}

// 전체 종목 로드
function loadAllStocks() {
    // 샘플 종목 리스트
    allStocks = [
        { ticker: '005930', name: '삼성전자', sector: '전기전자/반도체' },
        { ticker: '373220', name: 'LG에너지솔루션', sector: '전기전자/2차전지' },
        { ticker: '352820', name: '하이브', sector: '미디어/엔터테인먼트' },
        { ticker: '000660', name: 'SK하이닉스', sector: '전기전자/반도체' },
        { ticker: '035720', name: '카카오', sector: 'IT/인터넷' },
        { ticker: '035420', name: 'NAVER', sector: 'IT/인터넷' }
    ];
}

// 종목 검색
function searchStocks(query) {
    const container = $('#searchResults');
    container.empty();
    
    if (query.length < 1) {
        return;
    }
    
    // 검색 로직
    const results = allStocks.filter(stock => 
        stock.name.includes(query) || 
        stock.ticker.includes(query.toUpperCase())
    ).slice(0, 10);
    
    if (results.length === 0) {
        container.html('<div class="p-4 text-center text-muted">검색 결과가 없습니다.</div>');
        return;
    }
    
    results.forEach(stock => {
        const item = `
            <div class="search-item" onclick="addToWatchlist('${stock.ticker}', '${stock.name}')">
                <div class="search-item-name">${stock.name}</div>
                <div class="search-item-info">${stock.ticker} | ${stock.sector || '주식'}</div>
            </div>
        `;
        container.append(item);
    });
}

// 관심 종목 추가
function addToWatchlist(ticker, name) {
    $.ajax({
        url: '/api/watchlist',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({ ticker: ticker }),
        success: function() {
            $('#addWatchlistModal').modal('hide');
            loadWatchlist();
            loadWatchlistNews();
            alert(`${name}이(가) 관심 종목에 추가되었습니다.`);
        },
        error: function() {
            alert('관심 종목 추가에 실패했습니다.');
        }
    });
}

// 종목 상세 보기
function viewStockDetail(ticker) {
    window.location.href = `/stock?ticker=${ticker}`;
}

// 알림 닫기
function dismissAlert(btn) {
    $(btn).closest('.alert-card').fadeOut();
}

// 캐러셀 스크롤
function scrollWatchlist(direction) {
    const container = document.getElementById('watchlist-container');
    const scrollAmount = 300;
    
    if (direction === 'left') {
        container.scrollLeft -= scrollAmount;
    } else {
        container.scrollLeft += scrollAmount;
    }
}

// 숫자 포맷팅
function formatNumber(num) {
    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

// 날짜 포맷팅
function formatNewsDate(dateStr) {
    const date = new Date(dateStr);
    const now = new Date();
    const diff = now - date;
    const hours = Math.floor(diff / (1000 * 60 * 60));
    
    if (hours < 1) return '방금 전';
    if (hours < 24) return `${hours}시간 전`;
    if (hours < 48) return '어제';
    if (hours < 72) return '2일 전';
    return date.toLocaleDateString('ko-KR');
}

// 종목별 뉴스 타이틀 가져오기
function getStockNewsTitle(ticker) {
    const newsMap = {
        '005930': '삼성전자, 반도체 수출 호조로 강세',
        '373220': '美 IRA 수혜 기대감…LG엔솔 반등세 주목',
        '352820': 'BTS 솔로 활동 본격화…하이브 실적 훈풍'
    };
    return newsMap[ticker] || '최신 뉴스를 불러오는 중...';
}

// 위험 분석 리포트 표시
function showRiskReport(ticker) {
    console.log('위험 분석 리포트 표시:', ticker);
    
    // 로딩 표시
    $('#riskReportContent').html('<div class="text-center p-5"><div class="spinner-border" role="status"><span class="visually-hidden">로딩 중...</span></div></div>');
    $('#riskReportModal').modal('show');
    
    // API 호출
    $.ajax({
        url: `/api/risk-alert-details/${ticker}`,
        method: 'GET',
        success: function(response) {
            if (response.success && response.risk_report) {
                displayRiskReport(response.risk_report);
            } else {
                $('#riskReportContent').html('<p class="text-center text-muted">위험 분석 리포트를 생성할 수 없습니다.</p>');
            }
        },
        error: function(error) {
            console.error('위험 분석 리포트 로드 실패:', error);
            $('#riskReportContent').html('<p class="text-center text-danger">리포트 로드 중 오류가 발생했습니다.</p>');
        }
    });
}

// 위험 분석 리포트 렌더링
function displayRiskReport(report) {
    const riskLevelClass = report.executive_summary.risk_level;
    const riskLevelText = {
        'critical': '심각',
        'high': '높음',
        'medium': '중간',
        'low': '낮음'
    }[report.executive_summary.risk_level] || '알 수 없음';
    
    // 리포트 HTML 생성
    const reportHtml = `
        <div class="risk-report">
            <!-- 요약 정보 -->
            <div class="risk-summary ${riskLevelClass}">
                <span class="risk-level-badge ${riskLevelClass}">${riskLevelText} 위험</span>
                <h4>${report.executive_summary.main_risk}</h4>
                <p>${report.executive_summary.description}</p>
            </div>
            
            <!-- 주요 지표 -->
            <h5 class="mb-3">주요 재무 지표</h5>
            <div class="metric-grid">
                ${Object.entries(report.detailed_analysis.key_metrics || {}).slice(0, 4).map(([key, value]) => `
                    <div class="metric-card">
                        <div class="metric-label">${getMetricLabel(key)}</div>
                        <div class="metric-value">${formatMetricValue(key, value)}</div>
                    </div>
                `).join('')}
            </div>
            
            <!-- 위험 요인 분석 -->
            <h5 class="mb-3 mt-4">위험 요인 분석</h5>
            <div class="risk-factors">
                ${report.detailed_analysis.risk_factors.map(factor => `
                    <div class="risk-factor-item">
                        <div class="risk-factor-title">${factor.title}</div>
                        <div class="risk-factor-analysis">${factor.analysis}</div>
                    </div>
                `).join('')}
            </div>
            
            <!-- 권장사항 -->
            <h5 class="mb-3 mt-4">권장사항</h5>
            <div class="recommendations-section">
                <h6>즉시 조치사항</h6>
                <ul class="recommendation-list">
                    ${report.recommendations.immediate_actions.map(action => `<li>${action}</li>`).join('')}
                </ul>
                
                ${report.recommendations.monitoring_points.length > 0 ? `
                    <h6 class="mt-3">모니터링 포인트</h6>
                    <ul class="recommendation-list">
                        ${report.recommendations.monitoring_points.map(point => `<li>${point}</li>`).join('')}
                    </ul>
                ` : ''}
            </div>
        </div>
    `;
    
    $('#riskReportContent').html(reportHtml);
    $('#riskReportTitle').text(`${report.stock_name} 위험 분석 리포트`);
}

// 지표 라벨 변환
function getMetricLabel(key) {
    const labels = {
        'roe': 'ROE',
        'roa': 'ROA',
        'debt_ratio': '부채비율',
        'current_ratio': '유동비율',
        'per': 'PER',
        'pbr': 'PBR',
        'operating_margin': '영업이익률',
        'gross_margin': '매출총이익률'
    };
    return labels[key] || key;
}

// 지표 값 포맷팅
function formatMetricValue(key, value) {
    if (typeof value === 'number') {
        if (key.includes('ratio') || key.includes('margin') || key === 'roe' || key === 'roa') {
            return `${(value * 100).toFixed(1)}%`;
        } else if (key === 'per' || key === 'pbr') {
            return `${value.toFixed(1)}배`;
        }
    }
    return value || '-';
}

// 리포트 다운로드 (미구현)
function downloadRiskReport() {
    alert('리포트 다운로드 기능은 준비 중입니다.');
}

</script>
{% endblock %}
{% block extra_js %}
<script>
// jQuery가 로드된 후 실행
$(document).ready(function() {
    console.log('My Investment 페이지 초기화 (jQuery ready)');
    
    // 각 섹션 데이터 로드
    loadFinancialInsights();  // 핵심 투자 인사이트 로드
    loadRiskAlerts();         // 위험 신호 로드
    loadWatchlistNews();      // 관심 종목 뉴스 로드
    
    // 관심 종목 관련
    loadWatchlist();
    loadAllStocks();
    
    // 종목 검색 이벤트
    $('#stockSearch').on('input', function() {
        searchStocks($(this).val());
    });
});
</script>
{% endblock %}