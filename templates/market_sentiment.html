{% extends 'layout.html' %}
{% block title %}시장 감정 분석{% endblock %}
{% block content %}
<style>
/* 시장 감정 대시보드 스타일 */
.sentiment-dashboard {
    padding: 40px 0;
    max-width: 1440px;
    margin: 0 auto;
}

.dashboard-header {
    text-align: center;
    margin-bottom: 40px;
}

.dashboard-title {
    font-size: 36px;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 12px;
}

.dashboard-subtitle {
    font-size: 18px;
    color: #666;
}

/* 감정 지수 게이지 */
.sentiment-gauge-container {
    background: white;
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    margin-bottom: 40px;
}

.sentiment-gauge {
    width: 300px;
    height: 300px;
    margin: 0 auto;
    position: relative;
}

.gauge-background {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: conic-gradient(
        from 180deg,
        #dc2626 0deg,
        #ef4444 60deg,
        #f59e0b 120deg,
        #eab308 180deg,
        #84cc16 240deg,
        #22c55e 300deg,
        #22c55e 360deg
    );
    position: relative;
    overflow: hidden;
}

.gauge-center {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 220px;
    height: 220px;
    background: white;
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.sentiment-score {
    font-size: 72px;
    font-weight: 700;
    color: #1a1a1a;
    line-height: 1;
}

.sentiment-label {
    font-size: 24px;
    font-weight: 600;
    margin-top: 8px;
}

.sentiment-label.positive {
    color: #22c55e;
}

.sentiment-label.neutral {
    color: #f59e0b;
}

.sentiment-label.negative {
    color: #dc2626;
}

.sentiment-description {
    font-size: 16px;
    color: #666;
    margin-top: 8px;
    text-align: center;
}

/* 감정 통계 카드 */
.sentiment-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 24px;
    margin-bottom: 40px;
}

.stat-card {
    background: white;
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    transition: transform 0.2s;
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.stat-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 16px;
}

.stat-icon.positive {
    background: rgba(34, 197, 94, 0.1);
    color: #22c55e;
}

.stat-icon.negative {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
}

.stat-icon.neutral {
    background: rgba(245, 158, 11, 0.1);
    color: #f59e0b;
}

.stat-value {
    font-size: 32px;
    font-weight: 700;
    color: #1a1a1a;
    margin-bottom: 4px;
}

.stat-label {
    font-size: 14px;
    color: #666;
    margin-bottom: 12px;
}

.stat-change {
    font-size: 14px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 4px;
}

.stat-change.up {
    color: #22c55e;
}

.stat-change.down {
    color: #ef4444;
}

/* 섹터별 감정 히트맵 */
.sector-sentiment {
    background: white;
    border-radius: 20px;
    padding: 32px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    margin-bottom: 40px;
}

.sector-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 12px;
    margin-top: 24px;
}

.sector-item {
    padding: 20px;
    border-radius: 12px;
    text-align: center;
    transition: all 0.3s;
    cursor: pointer;
}

.sector-item:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.sector-item.very-positive {
    background: #22c55e;
    color: white;
}

.sector-item.positive {
    background: #86efac;
    color: #166534;
}

.sector-item.neutral {
    background: #fde047;
    color: #713f12;
}

.sector-item.negative {
    background: #fca5a5;
    color: #991b1b;
}

.sector-item.very-negative {
    background: #ef4444;
    color: white;
}

.sector-name {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 8px;
}

.sector-score {
    font-size: 24px;
    font-weight: 700;
}

/* 감정 추이 차트 */
.sentiment-chart {
    background: white;
    border-radius: 20px;
    padding: 32px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

.chart-container {
    position: relative;
    height: 400px;
    margin-top: 24px;
}
</style>

<div class="sentiment-dashboard">
    <div class="dashboard-header">
        <h1 class="dashboard-title">실시간 시장 감정 분석</h1>
        <p class="dashboard-subtitle">뉴스 빅데이터 기반 AI 감정 분석으로 시장 심리를 파악하세요</p>
    </div>

    <!-- 시장 감정 게이지 -->
    <div class="sentiment-gauge-container">
        <div class="sentiment-gauge">
            <div class="gauge-background"></div>
            <div class="gauge-center">
                <div class="sentiment-score" id="sentimentScore">75</div>
                <div class="sentiment-label positive" id="sentimentLabel">긍정적</div>
                <div class="sentiment-description" id="sentimentDesc">시장이 전반적으로 낙관적입니다</div>
            </div>
        </div>
    </div>

    <!-- 감정 통계 카드 -->
    <div class="sentiment-stats">
        <div class="stat-card">
            <div class="stat-icon positive">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M7 17L17 7M17 7H7M17 7V17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </div>
            <div class="stat-value" id="positiveCount">142</div>
            <div class="stat-label">긍정 뉴스</div>
            <div class="stat-change up">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                    <path d="M7 17L17 7M17 7H7M17 7V17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span>+12% 증가</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon negative">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M7 7L17 17M7 17L17 7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </div>
            <div class="stat-value" id="negativeCount">58</div>
            <div class="stat-label">부정 뉴스</div>
            <div class="stat-change down">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                    <path d="M7 7L17 17M17 17H7M17 17V7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span>-8% 감소</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon neutral">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </div>
            <div class="stat-value">71%</div>
            <div class="stat-label">긍정 비율</div>
            <div class="stat-change up">
                <span>전일 대비 +5%p</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon positive">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M13 7L3 7M3 7L3 17M3 7L12 16L16 12L21 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <div class="stat-value">강세</div>
            <div class="stat-label">투자 신호</div>
            <div class="stat-change">
                <span>적극 매수 구간</span>
            </div>
        </div>
    </div>

    <!-- 섹터별 감정 히트맵 -->
    <div class="sector-sentiment">
        <h2 style="font-size: 24px; font-weight: 700; margin-bottom: 8px;">섹터별 감정 분석</h2>
        <p style="color: #666; margin-bottom: 24px;">업종별 뉴스 감정 점수를 한눈에 확인하세요</p>
        
        <div class="sector-grid" id="sectorGrid">
            <div class="sector-item very-positive">
                <div class="sector-name">반도체</div>
                <div class="sector-score">87</div>
            </div>
            <div class="sector-item positive">
                <div class="sector-name">2차전지</div>
                <div class="sector-score">72</div>
            </div>
            <div class="sector-item positive">
                <div class="sector-name">바이오</div>
                <div class="sector-score">68</div>
            </div>
            <div class="sector-item neutral">
                <div class="sector-name">자동차</div>
                <div class="sector-score">52</div>
            </div>
            <div class="sector-item neutral">
                <div class="sector-name">금융</div>
                <div class="sector-score">48</div>
            </div>
            <div class="sector-item negative">
                <div class="sector-name">건설</div>
                <div class="sector-score">35</div>
            </div>
            <div class="sector-item positive">
                <div class="sector-name">엔터</div>
                <div class="sector-score">65</div>
            </div>
            <div class="sector-item very-positive">
                <div class="sector-name">게임</div>
                <div class="sector-score">82</div>
            </div>
        </div>
    </div>

    <!-- 감정 추이 차트 -->
    <div class="sentiment-chart">
        <h2 style="font-size: 24px; font-weight: 700; margin-bottom: 8px;">시장 감정 추이</h2>
        <p style="color: #666;">최근 7일간 시장 감정 변화 추이</p>
        
        <div class="chart-container">
            <canvas id="sentimentTrendChart"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// 시장 감정 데이터 로드
async function loadMarketSentiment() {
    try {
        const response = await fetch('/api/market-sentiment');
        const data = await response.json();
        
        if (data.success) {
            updateSentimentGauge(data.sentiment_score);
            updateSentimentStats(data.stats);
            updateSectorHeatmap(data.sectors);
            updateSentimentChart(data.trend);
        }
    } catch (error) {
        console.error('시장 감정 데이터 로드 실패:', error);
    }
}

// 감정 게이지 업데이트
function updateSentimentGauge(score) {
    const scoreElement = document.getElementById('sentimentScore');
    const labelElement = document.getElementById('sentimentLabel');
    const descElement = document.getElementById('sentimentDesc');
    
    scoreElement.textContent = score;
    
    if (score >= 70) {
        labelElement.textContent = '매우 긍정';
        labelElement.className = 'sentiment-label positive';
        descElement.textContent = '시장이 매우 낙관적입니다. 과열 주의';
    } else if (score >= 55) {
        labelElement.textContent = '긍정적';
        labelElement.className = 'sentiment-label positive';
        descElement.textContent = '시장이 전반적으로 낙관적입니다';
    } else if (score >= 45) {
        labelElement.textContent = '중립';
        labelElement.className = 'sentiment-label neutral';
        descElement.textContent = '시장이 관망세를 보이고 있습니다';
    } else if (score >= 30) {
        labelElement.textContent = '부정적';
        labelElement.className = 'sentiment-label negative';
        descElement.textContent = '시장이 조심스러운 분위기입니다';
    } else {
        labelElement.textContent = '매우 부정';
        labelElement.className = 'sentiment-label negative';
        descElement.textContent = '시장이 매우 비관적입니다. 기회 포착';
    }
}

// 감정 통계 업데이트
function updateSentimentStats(stats) {
    if (stats.positive_count) {
        document.getElementById('positiveCount').textContent = stats.positive_count;
    }
    if (stats.negative_count) {
        document.getElementById('negativeCount').textContent = stats.negative_count;
    }
}

// 섹터별 히트맵 업데이트
function updateSectorHeatmap(sectors) {
    const grid = document.getElementById('sectorGrid');
    grid.innerHTML = '';
    
    sectors.forEach(sector => {
        const item = document.createElement('div');
        let className = 'sector-item ';
        
        if (sector.score >= 80) className += 'very-positive';
        else if (sector.score >= 60) className += 'positive';
        else if (sector.score >= 40) className += 'neutral';
        else if (sector.score >= 20) className += 'negative';
        else className += 'very-negative';
        
        item.className = className;
        item.innerHTML = `
            <div class="sector-name">${sector.name}</div>
            <div class="sector-score">${sector.score}</div>
        `;
        
        grid.appendChild(item);
    });
}

// 감정 추이 차트 업데이트
function updateSentimentChart(trendData) {
    const ctx = document.getElementById('sentimentTrendChart').getContext('2d');
    
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: trendData.labels || ['6일전', '5일전', '4일전', '3일전', '2일전', '어제', '오늘'],
            datasets: [{
                label: '시장 감정 지수',
                data: trendData.scores || [58, 62, 55, 68, 72, 70, 75],
                borderColor: '#1454FE',
                backgroundColor: 'rgba(20, 84, 254, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    ticks: {
                        callback: function(value) {
                            return value + '점';
                        }
                    }
                }
            }
        }
    });
}

// 페이지 로드 시 실행
document.addEventListener('DOMContentLoaded', function() {
    loadMarketSentiment();
    
    // 5분마다 자동 갱신
    setInterval(loadMarketSentiment, 5 * 60 * 1000);
});
</script>
{% endblock %}